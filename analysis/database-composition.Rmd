---
title: "Database composition"
author: "Tina Lasisi"
date: "`r format(Sys.time(), '%Y-%m-%d %H:%M:%S')`"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

# Forensic

Data based on Murphy & Tong


## Analysis of Demographic Group Representation in Database vs Population

This document presents an analysis of the representation of various demographic groups in a database compared to their representation in the general population across different states.

### Data Loading and Preparation

We start by loading the necessary libraries and the dataset.

```{r}
library(tidyverse)

# Load the dataset
data <- read_csv("data/df_state-breakdown.csv")
data_total <- read_csv("data/df_state_total.csv")
```

### Data Cleaning
The data contains demographic information with percentages in two contexts: 'Database' and 'Population'. We need to clean and transform the data for analysis.

```{r}
# Convert the 'Value' column to numeric
data <- data %>%
  mutate(Value = as.numeric(str_remove(Value, "%")) / 100)

# Separate the data into database and population datasets
database_data <- data %>% filter(Context == "Database")
population_data <- data %>% filter(Context == "Population")

# Merge the two datasets
merged_data <- database_data %>%
  inner_join(population_data, by = c("State", "Demographic Group")) %>%
  rename(Value_Database = Value.x, Value_Population = Value.y) %>%
  mutate(Difference = Value_Database - Value_Population)

```

### Data Visualization
We create a visualization to show the differences in representation for each demographic group by state.

```{r}
# Plotting the differences
ggplot(merged_data, aes(x = State, y = Difference, fill = `Demographic Group`)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8)) +
  theme_minimal() +
  labs(title = "Difference in Demographic Group Representation: Database vs Population by State",
       x = "State", y = "Difference in Representation") +
  geom_hline(yintercept = 0, linetype = 1)

```

### Summary Table
Finally, we create a summary table showing the difference in representation for each state and demographic group.

```{r}
# Creating the summary table
state_group_summary <- merged_data %>%
  group_by(State, `Demographic Group`) %>%
  summarize(Difference = mean(Difference)) %>%
  ungroup()

state_group_summary
```


