<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Junhui He" />

<meta name="date" content="2025-07-04" />

<title>Fertility Modelling and Sibling Estimates</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/main/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>



<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">PODFRIDGE</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/lasisilab/PODFRIDGE">
    <span class="fab fa-github"></span>
     
    Source code
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Fertility Modelling and Sibling
Estimates</h1>
<h4 class="author">Junhui He</h4>
<h4 class="date">2025-07-04</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span>
workflowr <span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span
class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2025-07-04
</p>
<p>
<strong>Checks:</strong> <span
class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7
<span class="glyphicon glyphicon-exclamation-sign text-danger"
aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>PODFRIDGE/</code> <span
class="glyphicon glyphicon-question-sign" aria-hidden="true"
title="This is the local directory in which the code in this file was executed.">
</span>
</p>
<p>
This reproducible <a href="https://rmarkdown.rstudio.com">R Markdown</a>
analysis was created with <a
  href="https://github.com/workflowr/workflowr">workflowr</a> (version
1.7.1). The <em>Checks</em> tab describes the reproducibility checks
that were applied when the results were created. The <em>Past
versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date
</a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate"
class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git
repository, you know the exact version of the code that produced these
results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the
global environment can affect the analysis in your R Markdown file in
unknown ways. For reproduciblity it’s best to always run the code in an
empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20230302code">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Seed:</strong>
<code>set.seed(20230302)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20230302code"
class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20230302)</code> was run prior to running
the code in the R Markdown file. Setting a seed ensures that any results
that rely on randomness, e.g. subsampling or permutations, are
reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Session information:</strong>
recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded"
class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package
versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be
confident that you successfully produced the results during this
run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr
project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomlasisilabPODFRIDGEtreebe6c40df27b8c668172cf12c524ea356ae39b531targetblankbe6c40da">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Repository version:</strong>
<a href="https://github.com/lasisilab/PODFRIDGE/tree/be6c40df27b8c668172cf12c524ea356ae39b531" target="_blank">be6c40d</a>
</a>
</p>
</div>
<div
id="strongRepositoryversionstrongahrefhttpsgithubcomlasisilabPODFRIDGEtreebe6c40df27b8c668172cf12c524ea356ae39b531targetblankbe6c40da"
class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development
and connecting the code version to the results is critical for
reproducibility.
</p>
<p>
The results in this page were generated with repository version
<a href="https://github.com/lasisilab/PODFRIDGE/tree/be6c40df27b8c668172cf12c524ea356ae39b531" target="_blank">be6c40d</a>.
See the <em>Past versions</em> tab to see a history of the changes made
to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for
the analysis have been committed to Git prior to generating the results
(you can use <code>wflow_publish</code> or
<code>wflow_git_commit</code>). workflowr only checks the R Markdown
file, but you know if there are other scripts or data files that it
depends on. Below is the status of the Git repository when the results
were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .DS_Store
    Ignored:    .Rhistory
    Ignored:    .Rproj.user/
    Ignored:    analysis/.DS_Store
    Ignored:    code/.DS_Store
    Ignored:    data/.DS_Store
    Ignored:    output/.DS_Store

Untracked files:
    Untracked:  data/Murphy_combined_data.csv
    Untracked:  data/internal/
    Untracked:  data/raw/
    Untracked:  data/regression_data/Murphy_combined_data.csv
    Untracked:  output/SDIS_racial_composition.csv
    Untracked:  output/pmf_sibling_counts.csv
    Untracked:  output/pmf_sibling_counts.png

Unstaged changes:
    Modified:   analysis/codis_regression.Rmd
    Modified:   analysis/forensic_databases.Rmd
    Modified:   analysis/racial_proportion.Rmd
    Modified:   analysis/regression.Rmd
    Modified:   data/final_CODIS_data.csv

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not
included in this status report because it is ok for generated content to
have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">
<p>
These are the previous versions of the repository in which changes were
made to the R Markdown (<code>analysis/fert_model.Rmd</code>) and HTML
(<code>docs/fert_model.html</code>) files. If you’ve configured a remote
Git repository (see <code>?wflow_git_remote</code>), click on the
hyperlinks in the table below to view the files as they were in that
past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/lasisilab/PODFRIDGE/blob/be6c40df27b8c668172cf12c524ea356ae39b531/analysis/fert_model.Rmd" target="_blank">be6c40d</a>
</td>
<td>
Junhui He
</td>
<td>
2025-07-04
</td>
<td>
wflow_publish("analysis/fert_model.Rmd")
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<div id="u.s.-census-data-in-fertility" class="section level1">
<h1>1 U.S. Census Data in Fertility</h1>
<p>We extract the fertility information for U.S. women aged 50‑59 in the
1990 Census. Women aged 50–59 in the 1990 U.S. Census were born between
1931 and 1940. Assuming a typical childbearing age range of 25–45, their
children would have been born between approximately 1956 and 1985.
Therefore, the fertility distributions and relative counts estimated
from this cohort primarily reflect the family-building behaviors and
social contexts of the mid-1950s through the mid-1980s. We filter to
Black/African American and White American groups as these are of
interest to our paper.</p>
<div id="load-the-prefiltered-ipums-subset" class="section level2">
<h2>Load the pre‑filtered IPUMS subset</h2>
<pre class="r"><code>path         &lt;- file.path(&quot;.&quot;, &quot;data&quot;)
prop_race_year &lt;- file.path(path, &quot;proportions_table_by_race_year.csv&quot;)
data_filter    &lt;- file.path(path, &quot;data_filtered_recoded.csv&quot;)

## original script loads both; we only need mother_data for this step
mother_data &lt;- read_csv(data_filter, show_col_types = FALSE)</code></pre>
<p><code>mother_data</code> already contains:</p>
<ul>
<li><code>YEAR</code> – Census year (1960,1970,1980,1990)</li>
<li><code>AGE</code> – respondent age</li>
<li><code>RACE</code> – recoded as “White” or “Black/African
American”</li>
<li><code>chborn_num</code> – completed fertility (children ever
born)</li>
</ul>
</div>
<div id="select-the-1990-age-5059-cohort" class="section level2">
<h2>Select the 1990, age 50‑59 cohort</h2>
<pre class="r"><code>cohort &lt;- mother_data %&gt;%
  filter(YEAR == 1990,
         AGE  &gt;= 50, AGE &lt;= 59,
         RACE %in% c(&quot;White&quot;, &quot;Black/African American&quot;)) %&gt;%
  mutate(RACE = droplevels(factor(RACE))) %&gt;% dplyr::select(&quot;YEAR&quot;, &quot;AGE&quot;, &quot;RACE&quot;, &quot;chborn_num&quot;)

cohort %&gt;% count(RACE, name = &quot;n_women&quot;)</code></pre>
<pre><code># A tibble: 2 × 2
  RACE                   n_women
  &lt;fct&gt;                    &lt;int&gt;
1 Black/African American   10945
2 White                    96079</code></pre>
<pre class="r"><code>kable(head(cohort, n = 15), caption = &quot;Fertility data for U.S. women aged 50‑59 in the 1990 Census.&quot;)</code></pre>
<table>
<caption>Fertility data for U.S. women aged 50‑59 in the 1990
Census.</caption>
<thead>
<tr class="header">
<th align="right">YEAR</th>
<th align="right">AGE</th>
<th align="left">RACE</th>
<th align="right">chborn_num</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1990</td>
<td align="right">53</td>
<td align="left">White</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="right">52</td>
<td align="left">White</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="right">50</td>
<td align="left">White</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="right">59</td>
<td align="left">White</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="right">55</td>
<td align="left">White</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="right">53</td>
<td align="left">White</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="right">55</td>
<td align="left">White</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="right">58</td>
<td align="left">White</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="right">50</td>
<td align="left">White</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="right">54</td>
<td align="left">White</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="right">59</td>
<td align="left">White</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="right">57</td>
<td align="left">White</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="right">51</td>
<td align="left">White</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="right">50</td>
<td align="left">Black/African American</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="right">55</td>
<td align="left">White</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
</div>
<div id="prepare-individual-level-sibling-counts"
class="section level2">
<h2>Prepare individual-level sibling counts</h2>
<pre class="r"><code># Prepare individual-level sibling count
sibs_long &lt;- cohort %&gt;%
  mutate(mother_id = row_number()) %&gt;%
  filter(chborn_num &gt; 0) %&gt;%
  tidyr::uncount(chborn_num, .remove = FALSE) %&gt;%
  mutate(n_sib = chborn_num - 1)

kable(head(sibs_long, n = 15), caption = &quot;Corresponding sibling data calculated from fertility data&quot;)</code></pre>
<table>
<caption>Corresponding sibling data calculated from fertility
data</caption>
<thead>
<tr class="header">
<th align="right">YEAR</th>
<th align="right">AGE</th>
<th align="left">RACE</th>
<th align="right">chborn_num</th>
<th align="right">mother_id</th>
<th align="right">n_sib</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1990</td>
<td align="right">53</td>
<td align="left">White</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="right">53</td>
<td align="left">White</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="right">53</td>
<td align="left">White</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="right">52</td>
<td align="left">White</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="right">52</td>
<td align="left">White</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="right">52</td>
<td align="left">White</td>
<td align="right">3</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="right">50</td>
<td align="left">White</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="right">50</td>
<td align="left">White</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="right">59</td>
<td align="left">White</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="right">59</td>
<td align="left">White</td>
<td align="right">2</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="right">53</td>
<td align="left">White</td>
<td align="right">3</td>
<td align="right">6</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="right">53</td>
<td align="left">White</td>
<td align="right">3</td>
<td align="right">6</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="right">53</td>
<td align="left">White</td>
<td align="right">3</td>
<td align="right">6</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1990</td>
<td align="right">55</td>
<td align="left">White</td>
<td align="right">4</td>
<td align="right">7</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">1990</td>
<td align="right">55</td>
<td align="left">White</td>
<td align="right">4</td>
<td align="right">7</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="family-structure-modelling" class="section level1">
<h1>2 Family structure modelling</h1>
<p>Here we establish statistical models for the <strong>fertility
distribution</strong> and <strong>sibling distribution</strong>. The
fertility distribution describes the number of children per family,
while the sibling distribution describes the number of siblings per
person.</p>
<div id="fertility-distribution" class="section level2">
<h2>Fertility distribution</h2>
<p>We model the number of children per family using a <strong>Poisson
distribution</strong> and a <strong>zero inflated negative binomial
distribution (ZINB)</strong>, respectively.</p>
<div id="poisson-distribution" class="section level3">
<h3>Poisson distribution</h3>
<p>The <strong>Poisson distribution</strong> is a common model for count
data, particularly when the mean and variance are equal. However, it may
not be suitable for fertility data, which often exhibit zero-inflation
and overdispersion (variance greater than the mean). The Poisson
distribution with <strong>mean fertility</strong> (<span
class="math inline">\(\mu\)</span>) is defined as: for a count <span
class="math inline">\(k \geq 0\)</span>, <span
class="math display">\[P(num_{child}=k)=e^{-\mu}\frac{\mu^k}{k!},\]</span>
denoted by <span class="math inline">\(Poisson(\mu)\)</span>. The mean
and variance of <span class="math inline">\(Poisson(\mu)\)</span> are
both <span class="math inline">\(\mu\)</span>.</p>
</div>
<div id="zero-inflated-negative-binomial-distribution"
class="section level3">
<h3>Zero inflated negative binomial distribution</h3>
<p>The <strong>zero inflated negative binomial distribution</strong>
with parameters <strong>mean fertility</strong> (<span
class="math inline">\(\mu\)</span>), <strong>dispersion/size</strong>
(<span class="math inline">\(\theta\)</span>), and
<strong>zero‑inflation probability</strong> (<span
class="math inline">\(\pi_0\)</span>)—denoted as <span
class="math inline">\(ZINB(\mu, \theta, \pi_0)\)</span>—is defined as:
for a count <span class="math inline">\(k \geq 0\)</span>, <span
class="math display">\[P(num_{child}=k)=\begin{cases}
\pi_0 + (1-\pi_0)p^{\theta} &amp; \text{if } k=0, \\
(1-\pi_0)\binom{k+\theta-1}{k}(1-p)^k p ^{\theta} &amp; \text{if } k
\geq 1,
\end{cases}\]</span> where <span class="math inline">\(p =
\frac{\theta}{\mu+\theta}\)</span> represents the success probability of
the negative binomial distribution.</p>
<p>According to the definition of the negative binomial distribution,
the mean and variance of <span
class="math inline">\(NB(\mu,\theta)\)</span> are given by <span
class="math inline">\(\mu\)</span> and <span class="math inline">\(\mu +
\frac{\mu^2}{\theta}\)</span>, respectively. Therefore, the mean and
variance of <span class="math inline">\(ZINB(\mu, \theta,
\pi_0)\)</span> are defined by <span
class="math inline">\(\mu(1-\pi_0)\)</span> and <span
class="math inline">\(\mu(1-\pi_0) +
\frac{\mu^2(1-\pi_0)}{\theta}+\mu^2\pi_0(1-\pi_0)\)</span>,
respectively.</p>
</div>
</div>
<div id="sibling-distribution" class="section level2">
<h2>Sibling distribution</h2>
<p>The <strong>sibling distribution</strong> can be derived from the
fertility distribution. For any count <span class="math inline">\(k \geq
0\)</span>, the probability that an individual has <span
class="math inline">\(k\)</span> siblings is proportional to the
probability that their mother has <span
class="math inline">\(k+1\)</span> children, multiplied by the number of
ways the individual could be one of those children. Therefore, the
sibling distribution satisfies: <span
class="math display">\[P(num_{sib}=k) \propto
(k+1)P(num_{child}=k+1).\]</span></p>
<div id="derivation-of-sibling-distribution" class="section level3">
<h3>Derivation of sibling distribution</h3>
<p>If the <strong>fertility distribution</strong> is <span
class="math inline">\(Poisson(\mu)\)</span>, then the <strong>sibling
distribution</strong> is given by: for a count <span
class="math inline">\(k \geq 0\)</span>, <span
class="math display">\[P(num_{sib}=k) \propto
(k+1)e^{-\mu}\frac{\mu^{k+1}}{(k+1)!} =
e^{-\mu}\frac{\mu^{k+1}}{k!}\propto e^{-\mu}\frac{\mu^k}{k!},\]</span>
which is also a <strong>Poisson distribution</strong> with mean <span
class="math inline">\(\mu\)</span>.</p>
<p>If the <strong>fertility distribution</strong> is <span
class="math inline">\(ZINB(\mu, \theta, \pi_0)\)</span>, then the
<strong>sibling distribution</strong> is given by: for a count <span
class="math inline">\(k \geq 0\)</span>, <span
class="math display">\[\begin{align*}
P(num_{sib}=k) &amp; \propto
(1-\pi_0)(k+1)\binom{k+\theta}{k+1}(1-p)^{k+1} p^{\theta} \\
&amp; = (1-\pi_0)(k+1)\frac{(k+\theta)!}{(k+1)!(\theta-1)!}(1-p)^{k+1}
p^{\theta} \\
&amp; \propto \frac{\theta(1-p)}{p} \frac{(k+\theta)!}{k!\theta!}(1-p)^k
p^{\theta+1} \\
&amp; \propto \binom{k+\theta}{k}(1-p)^k p^{\theta+1}, \\
\end{align*}\]</span> where <span class="math inline">\(p =
\frac{\theta}{\mu+\theta}\)</span>. Therefore, the sibling distribution
is a <strong>negative binomial distribution</strong> with parameters
<strong>mean fertility</strong> (<span
class="math inline">\(\frac{\mu(\theta+1)}{\theta}\)</span>),
<strong>dispersion/size</strong> (<span
class="math inline">\(\theta+1\)</span>), denoted as <span
class="math inline">\(NB(\frac{\mu(\theta+1)}{\theta},
\theta+1)\)</span>. The variance is <span
class="math inline">\(\frac{\mu(\theta+1)}{\theta} +
\frac{\mu^2(\theta+1)}{\theta^2}\)</span>.</p>
</div>
</div>
</div>
<div id="model-fitting" class="section level1">
<h1>3 Model fitting</h1>
<div id="fit-the-poisson-and-zinb-models" class="section level2">
<h2>Fit the Poisson and ZINB models</h2>
<pre class="r"><code>fit_fert &lt;- function(dat) {
  ## Poisson model
  pois &lt;- glm(chborn_num ~ 1, family = poisson, data = dat)
  
  ## Zero‑inflated negative binomial model
  zinb &lt;- zeroinfl(chborn_num ~ 1 | 1, data = dat, dist = &quot;negbin&quot;)
  
  tibble(
    Model = c(&quot;Poisson&quot;, &quot;ZINB&quot;),
    mu    = c(exp(coef(pois)[1]),                    ## log‑link → exp() gives mean
              exp(zinb$coefficients$count[1])),
    size  = c(Inf,                                   ## dispersion θ; Inf = Poisson
              zinb$theta),
    pi0   = c(0,                                      ## zero‑inflation prob.
              plogis(zinb$coefficients$zero[1]))
  )
}

param_fert &lt;- cohort %&gt;%
  group_by(RACE) %&gt;%
  group_modify(~ fit_fert(.x)) %&gt;%
  ungroup()</code></pre>
</div>
<div id="estimated-fertility-parameters" class="section level2">
<h2>Estimated fertility parameters</h2>
<pre class="r"><code>kable(param_fert, digits = 3, caption = &quot;Fertility‑model parameter estimates for women aged50‑59 (1990 Census)&quot;)</code></pre>
<table>
<caption>Fertility‑model parameter estimates for women aged50‑59 (1990
Census)</caption>
<thead>
<tr class="header">
<th align="left">RACE</th>
<th align="left">Model</th>
<th align="right">mu</th>
<th align="right">size</th>
<th align="right">pi0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Black/African American</td>
<td align="left">Poisson</td>
<td align="right">3.724</td>
<td align="right">Inf</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">Black/African American</td>
<td align="left">ZINB</td>
<td align="right">3.932</td>
<td align="right">4.289</td>
<td align="right">0.053</td>
</tr>
<tr class="odd">
<td align="left">White</td>
<td align="left">Poisson</td>
<td align="right">2.895</td>
<td align="right">Inf</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">White</td>
<td align="left">ZINB</td>
<td align="right">3.079</td>
<td align="right">257628.938</td>
<td align="right">0.060</td>
</tr>
</tbody>
</table>
</div>
<div id="compare-the-mean-and-variance-from-the-models-and-data"
class="section level2">
<h2>Compare the mean and variance from the models and data</h2>
<pre class="r"><code>cal_mean_var &lt;- function(model, mu, size, pi0) {
  if (model == &quot;Poisson&quot;) {
    mean_fert = mu
    var_fert  = mu
    mean_sib = mu
    var_sib  = mu
  } else if (model == &quot;ZINB&quot;) {
    mean_fert = mu * (1 - pi0)
    var_fert  = mu * (1 - pi0) + (mu^2 * (1 - pi0) / size) + (mu^2 * pi0 * (1 - pi0))
    mean_sib = mu * ((size + 1) / size)
    var_sib  = mu * ((size + 1) / size) + (mu^2 * ((size + 1) / size) / size)
  }
  
  tibble(
    Model = model,
    Mean_Fertility = mean_fert,
    Variance_Fertility = var_fert,
    Mean_Sibling = mean_sib,
    Variance_Sibling = var_sib
  )
}

mean_var_fitted &lt;- param_fert %&gt;%
  rowwise() %&gt;%
  do(cal_mean_var(.$Model, .$mu, .$size, .$pi0)) %&gt;%
  ungroup()

mean_var = data.frame(
  Race = rep(c(&quot;Black/African American&quot;, &quot;White&quot;), each = 3),
  Model = rep(c(&quot;Data&quot;, &quot;Poisson&quot;, &quot;ZINB&quot;), 2),
  Mean_Fertility = c(mean(cohort$chborn_num[cohort$RACE == &quot;Black/African American&quot;]), mean_var_fitted$Mean_Fertility[1], mean_var_fitted$Mean_Fertility[2], mean(cohort$chborn_num[cohort$RACE == &quot;White&quot;]), mean_var_fitted$Mean_Fertility[3], mean_var_fitted$Mean_Fertility[4]),
  Variance_Fertility = c(var(cohort$chborn_num[cohort$RACE == &quot;Black/African American&quot;]), mean_var_fitted$Variance_Fertility[1], mean_var_fitted$Variance_Fertility[2], var(cohort$chborn_num[cohort$RACE == &quot;White&quot;]), mean_var_fitted$Variance_Fertility[3], mean_var_fitted$Variance_Fertility[4]),
  Mean_Sibling = c(mean(sibs_long$n_sib[sibs_long$RACE == &quot;Black/African American&quot;]), mean_var_fitted$Mean_Sibling[1], mean_var_fitted$Mean_Sibling[2], mean(sibs_long$n_sib[sibs_long$RACE == &quot;White&quot;]), mean_var_fitted$Mean_Sibling[3], mean_var_fitted$Mean_Sibling[4]),
  Variance_Sibling = c(var(sibs_long$n_sib[sibs_long$RACE == &quot;Black/African American&quot;]), mean_var_fitted$Variance_Sibling[1], mean_var_fitted$Variance_Sibling[2], var(sibs_long$n_sib[sibs_long$RACE == &quot;White&quot;]), mean_var_fitted$Variance_Sibling[3], mean_var_fitted$Variance_Sibling[4])
)

kable(mean_var, digits = 3, caption = &quot;Mean and variance of fertility and sibling distributions from the fitted models and data.&quot;)</code></pre>
<table>
<caption>Mean and variance of fertility and sibling distributions from
the fitted models and data.</caption>
<colgroup>
<col width="24%" />
<col width="8%" />
<col width="15%" />
<col width="20%" />
<col width="13%" />
<col width="17%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Race</th>
<th align="left">Model</th>
<th align="right">Mean_Fertility</th>
<th align="right">Variance_Fertility</th>
<th align="right">Mean_Sibling</th>
<th align="right">Variance_Sibling</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Black/African American</td>
<td align="left">Data</td>
<td align="right">3.724</td>
<td align="right">7.742</td>
<td align="right">4.803</td>
<td align="right">7.971</td>
</tr>
<tr class="even">
<td align="left">Black/African American</td>
<td align="left">Poisson</td>
<td align="right">3.724</td>
<td align="right">3.724</td>
<td align="right">3.724</td>
<td align="right">3.724</td>
</tr>
<tr class="odd">
<td align="left">Black/African American</td>
<td align="left">ZINB</td>
<td align="right">3.724</td>
<td align="right">7.911</td>
<td align="right">4.848</td>
<td align="right">9.293</td>
</tr>
<tr class="even">
<td align="left">White</td>
<td align="left">Data</td>
<td align="right">2.895</td>
<td align="right">3.352</td>
<td align="right">3.053</td>
<td align="right">3.648</td>
</tr>
<tr class="odd">
<td align="left">White</td>
<td align="left">Poisson</td>
<td align="right">2.895</td>
<td align="right">2.895</td>
<td align="right">2.895</td>
<td align="right">2.895</td>
</tr>
<tr class="even">
<td align="left">White</td>
<td align="left">ZINB</td>
<td align="right">2.895</td>
<td align="right">3.428</td>
<td align="right">3.079</td>
<td align="right">3.079</td>
</tr>
</tbody>
</table>
</div>
<div id="model-evaluation" class="section level2">
<h2>Model evaluation</h2>
<p>Based on the table of mean and variance, we can see that the
fertility data exhibits <strong>overdispersion (variance greater than
mean)</strong>, especially for <strong>Black/African American</strong>.
The <strong>Poisson Model</strong> assumes equal mean and variance,
which does not fit the data well. The <strong>ZINB Model</strong>
accounts for overdispersion and zero-inflation, providing a better fit
to the data. The ZINB model’s mean and variance estimates for both
fertility and sibling distributions align more closely with the observed
data, particularly for the <strong>Black/African American</strong>
group, where the Poisson model fails to capture the higher variance.
Nevertheless, both models yield the same mean fertility counts, which is
equal to the sample mean of fertility data.</p>
</div>
</div>
<div id="simulations-of-fertility-and-sibling-distributions"
class="section level1">
<h1>4 Simulations of fertility and sibling distributions</h1>
<p>In this section, we simulate the fertility and sibling counts based
on the Poisson and ZINB distributions, respectively. We then compare the
empirical mean and variance of the simulated sibling data with the
theoretical values derived from Section 2.</p>
<div id="simulate-the-fertility-and-sibling-counts"
class="section level2">
<h2>Simulate the fertility and sibling counts</h2>
<pre class="r"><code>simulate_fert_sib &lt;- function(model, mu, size, pi0, n_sim = 20000, max_kids = 20) {
  if (model == &quot;Poisson&quot;) {
    # Simulate fertility counts from Poisson distribution
    fert_counts &lt;- pmin(rpois(n_sim, lambda = mu), max_kids)
  } else if (model == &quot;ZINB&quot;) {
    # Simulate fertility counts from ZINB distribution
    fert_counts &lt;- ifelse(runif(n_sim) &lt; pi0, 0, pmin(rnbinom(n_sim, size, mu = mu), max_kids))
  }
  
  # Simulate sibling counts based on fertility counts
  fert_counts_tibble &lt;- tibble(fert_counts = fert_counts)
  sib_counts_tibble &lt;- fert_counts_tibble %&gt;%
    filter(fert_counts &gt; 0) %&gt;%
    tidyr::uncount(fert_counts, .remove = FALSE) %&gt;%
    mutate(sib_counts = fert_counts - 1)
  sib_counts &lt;- sib_counts_tibble$sib_counts
  
  list(
    model = model,
    fert_counts = fert_counts,
    sib_counts = sib_counts
  )
}</code></pre>
</div>
<div
id="compare-sibling-counts-from-simulations-with-theoretical-values"
class="section level2">
<h2>Compare sibling counts from simulations with theoretical values</h2>
<p>We run simulations for fertility means of 1.5, 2.0, 2.5, 3.0, 3.5,
and 4.0 for both Poisson and ZINB models. Additionally, in ZINB models,
we set the dispersion parameter <span
class="math inline">\(\theta\)</span> to 4, and the zero-inflation
probability <span class="math inline">\(\pi_0\)</span> to 0.05.</p>
<p>We compare the empirical mean and variance of sibling counts from the
simulated data with the theoretical values. The comparison shows that
<strong>the theoretical values align closely with the simulated
results</strong>, confirming the correctness of our derivation.</p>
<pre class="r"><code>means = c(1.5, 2.0, 2.5, 3.0, 3.5, 4.0)
size = 4
pi0 = 0.05

cal_mean_var_simulated &lt;- function(sim_data) {
  sib_counts &lt;- sim_data$sib_counts
  
  mean_sib = mean(sib_counts)
  var_sib = var(sib_counts)
  
  tibble(
    Mean_Sibling = mean_sib,
    Variance_Sibling = var_sib
  )
}

# Poisson Model
simulated_poisson &lt;- lapply(means, function(mu) {
  simulate_fert_sib(&quot;Poisson&quot;, mu, Inf, 0)
})

simulated_poisson_results &lt;- lapply(simulated_poisson, cal_mean_var_simulated) %&gt;% bind_rows() %&gt;%
  mutate(Fertility_Parameter = sapply(means, function(mu) paste0(&quot;Fertility Mean = &quot;, mu)),
         Value_Type = &quot;Simulated Poisson&quot;) %&gt;% dplyr::select(Fertility_Parameter, Value_Type, everything())
threo_possion_results &lt;- tibble(
  Fertility_Parameter = sapply(means, function(mu) paste0(&quot;Fertility Mean = &quot;, mu)),
  Value_Type = &quot;Theoretical Poisson&quot;,
  Mean_Sibling = means,
  Variance_Sibling = means
)

poisson_results &lt;- bind_rows(simulated_poisson_results, threo_possion_results) %&gt;%
  arrange(Fertility_Parameter) %&gt;%
  mutate(Value_Type = factor(Value_Type, levels = c(&quot;Theoretical Poisson&quot;, &quot;Simulated Poisson&quot;)))

kable(poisson_results, digits = 3, caption = &quot;Mean and Variance of Sibling counts from simulations and theoretical values based on Poisson distribution.&quot;)</code></pre>
<table>
<caption>Mean and Variance of Sibling counts from simulations and
theoretical values based on Poisson distribution.</caption>
<colgroup>
<col width="29%" />
<col width="28%" />
<col width="18%" />
<col width="23%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Fertility_Parameter</th>
<th align="left">Value_Type</th>
<th align="right">Mean_Sibling</th>
<th align="right">Variance_Sibling</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Fertility Mean = 1.5</td>
<td align="left">Simulated Poisson</td>
<td align="right">1.486</td>
<td align="right">1.481</td>
</tr>
<tr class="even">
<td align="left">Fertility Mean = 1.5</td>
<td align="left">Theoretical Poisson</td>
<td align="right">1.500</td>
<td align="right">1.500</td>
</tr>
<tr class="odd">
<td align="left">Fertility Mean = 2</td>
<td align="left">Simulated Poisson</td>
<td align="right">1.997</td>
<td align="right">1.988</td>
</tr>
<tr class="even">
<td align="left">Fertility Mean = 2</td>
<td align="left">Theoretical Poisson</td>
<td align="right">2.000</td>
<td align="right">2.000</td>
</tr>
<tr class="odd">
<td align="left">Fertility Mean = 2.5</td>
<td align="left">Simulated Poisson</td>
<td align="right">2.492</td>
<td align="right">2.457</td>
</tr>
<tr class="even">
<td align="left">Fertility Mean = 2.5</td>
<td align="left">Theoretical Poisson</td>
<td align="right">2.500</td>
<td align="right">2.500</td>
</tr>
<tr class="odd">
<td align="left">Fertility Mean = 3</td>
<td align="left">Simulated Poisson</td>
<td align="right">3.004</td>
<td align="right">2.951</td>
</tr>
<tr class="even">
<td align="left">Fertility Mean = 3</td>
<td align="left">Theoretical Poisson</td>
<td align="right">3.000</td>
<td align="right">3.000</td>
</tr>
<tr class="odd">
<td align="left">Fertility Mean = 3.5</td>
<td align="left">Simulated Poisson</td>
<td align="right">3.490</td>
<td align="right">3.439</td>
</tr>
<tr class="even">
<td align="left">Fertility Mean = 3.5</td>
<td align="left">Theoretical Poisson</td>
<td align="right">3.500</td>
<td align="right">3.500</td>
</tr>
<tr class="odd">
<td align="left">Fertility Mean = 4</td>
<td align="left">Simulated Poisson</td>
<td align="right">3.986</td>
<td align="right">3.992</td>
</tr>
<tr class="even">
<td align="left">Fertility Mean = 4</td>
<td align="left">Theoretical Poisson</td>
<td align="right">4.000</td>
<td align="right">4.000</td>
</tr>
</tbody>
</table>
<pre class="r"><code># ZINB Model
simulated_zinb &lt;- lapply(means, function(mu) {
  simulate_fert_sib(&quot;ZINB&quot;, mu/(1-pi0), size, pi0)
})
simulated_zinb_results &lt;- lapply(simulated_zinb, cal_mean_var_simulated) %&gt;% bind_rows() %&gt;%
  mutate(Fertility_Parameter = sapply(means, function(mu) paste0(&quot;Fertility Mean = &quot;, mu)),
         Value_Type = &quot;Simulated ZINB&quot;) %&gt;% dplyr::select(Fertility_Parameter, Value_Type, everything())
mean_var_zinb &lt;- lapply(means, function(mu) cal_mean_var(&quot;ZINB&quot;, mu/(1-pi0), size, pi0)) %&gt;% bind_rows()
threo_zinb_results &lt;- tibble(
  Fertility_Parameter = sapply(means, function(mu) paste0(&quot;Fertility Mean = &quot;, mu)),
  Value_Type = &quot;Theoretical ZINB&quot;,
  Mean_Sibling = mean_var_zinb$Mean_Sibling,
  Variance_Sibling = mean_var_zinb$Variance_Sibling
)

zinb_results &lt;- bind_rows(simulated_zinb_results, threo_zinb_results) %&gt;%
  arrange(Fertility_Parameter) %&gt;%
  mutate(Value_Type = factor(Value_Type, levels = c(&quot;Theoretical ZINB&quot;, &quot;Simulated ZINB&quot;)))

kable(zinb_results, digits = 3, caption = &quot;Mean and Variance of Sibling counts from simulations and theoretical values based on ZINB distribution.&quot;)</code></pre>
<table>
<caption>Mean and Variance of Sibling counts from simulations and
theoretical values based on ZINB distribution.</caption>
<colgroup>
<col width="30%" />
<col width="25%" />
<col width="19%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Fertility_Parameter</th>
<th align="left">Value_Type</th>
<th align="right">Mean_Sibling</th>
<th align="right">Variance_Sibling</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Fertility Mean = 1.5</td>
<td align="left">Simulated ZINB</td>
<td align="right">1.990</td>
<td align="right">2.848</td>
</tr>
<tr class="even">
<td align="left">Fertility Mean = 1.5</td>
<td align="left">Theoretical ZINB</td>
<td align="right">1.974</td>
<td align="right">2.753</td>
</tr>
<tr class="odd">
<td align="left">Fertility Mean = 2</td>
<td align="left">Simulated ZINB</td>
<td align="right">2.610</td>
<td align="right">3.904</td>
</tr>
<tr class="even">
<td align="left">Fertility Mean = 2</td>
<td align="left">Theoretical ZINB</td>
<td align="right">2.632</td>
<td align="right">4.017</td>
</tr>
<tr class="odd">
<td align="left">Fertility Mean = 2.5</td>
<td align="left">Simulated ZINB</td>
<td align="right">3.269</td>
<td align="right">5.454</td>
</tr>
<tr class="even">
<td align="left">Fertility Mean = 2.5</td>
<td align="left">Theoretical ZINB</td>
<td align="right">3.289</td>
<td align="right">5.454</td>
</tr>
<tr class="odd">
<td align="left">Fertility Mean = 3</td>
<td align="left">Simulated ZINB</td>
<td align="right">3.944</td>
<td align="right">7.023</td>
</tr>
<tr class="even">
<td align="left">Fertility Mean = 3</td>
<td align="left">Theoretical ZINB</td>
<td align="right">3.947</td>
<td align="right">7.064</td>
</tr>
<tr class="odd">
<td align="left">Fertility Mean = 3.5</td>
<td align="left">Simulated ZINB</td>
<td align="right">4.628</td>
<td align="right">8.922</td>
</tr>
<tr class="even">
<td align="left">Fertility Mean = 3.5</td>
<td align="left">Theoretical ZINB</td>
<td align="right">4.605</td>
<td align="right">8.847</td>
</tr>
<tr class="odd">
<td align="left">Fertility Mean = 4</td>
<td align="left">Simulated ZINB</td>
<td align="right">5.207</td>
<td align="right">10.403</td>
</tr>
<tr class="even">
<td align="left">Fertility Mean = 4</td>
<td align="left">Theoretical ZINB</td>
<td align="right">5.263</td>
<td align="right">10.803</td>
</tr>
</tbody>
</table>
</div>
<div id="visualize-sibling-distributions" class="section level2">
<h2>Visualize sibling distributions</h2>
<p>We generate discrete probability distributions for sibling counts
based on both Poisson and ZINB models, with the y-axis representing the
number of siblings and the x-axis representing the probability of having
that many siblings. The fertility mean is set to 2.5, and the ZINB model
has a dispersion parameter of 4 and a zero-inflation probability of
0.05.</p>
<pre class="r"><code>library(viridisLite)

plot_pmf &lt;- function(pmf_df) {
  cats = sort(unique(pmf_df$sib_counts))
  n_cat &lt;- length(cats)
  color_palette &lt;- viridis(n_cat, option = &quot;D&quot;)
  df &lt;- pmf_df %&gt;%
    mutate(y = ifelse(Model == &quot;Poisson&quot;, -prob, prob),
           count_cat = factor(sib_counts, levels = cats))
  ggplot(df, aes(x = count_cat, y = y, fill = count_cat, alpha = Model)) +
    geom_col() +
    geom_hline(yintercept = 0, color = &quot;black&quot;, size = 0.5) +
    coord_flip() +
    scale_y_continuous(labels = function(x) abs(x)) +
    scale_fill_manual(values = color_palette, name = &quot;Siblings Count&quot;) +
    scale_alpha_manual(values = c(&quot;Poisson&quot; = 0.7, &quot;ZINB&quot; = 1), guide = &quot;none&quot;) +
    labs(
      title = &quot;PMF of Siblings Counts (Simulated from Poisson and ZINB Models)&quot;,
      x = &quot;Number of Siblings&quot;,
      y = &quot;Probability&quot;,
      caption = &quot;Poisson (left, negative y), ZINB (right, positive y).&quot;
    ) +
    theme_minimal(base_size = 13) +
    theme(
      plot.title = element_text(size = 14, hjust = 0.5),
      axis.text.y = element_text(size = 10),
      plot.caption = element_text(face = &quot;bold&quot;, size = 10),
      legend.position = &quot;right&quot;,
      panel.grid.major.y = element_blank(),
      panel.grid.minor.y = element_blank()
    )
}</code></pre>
<pre class="r"><code># fertility parameters
mean = 2.5
size = 4
pi0 = 0.05
max_sibs = 12

# simulated data for fertility mean 2.5
simulated_data &lt;- bind_rows(
  tibble(sib_counts = simulate_fert_sib(&quot;Poisson&quot;, mean, Inf, 0)$sib_counts) %&gt;%
    mutate(Model = &quot;Poisson&quot;),
  tibble(sib_counts = simulate_fert_sib(&quot;ZINB&quot;, mean/(1-pi0), size, pi0)$sib_counts) %&gt;%
    mutate(Model = &quot;ZINB&quot;)
)

simulated_data$sib_counts &lt;- ifelse(simulated_data$sib_counts &gt; max_sibs, max_sibs, simulated_data$sib_counts)

pmf_data &lt;- simulated_data %&gt;%
  count(Model, sib_counts, name = &quot;n_counts&quot;) %&gt;%
  group_by(Model) %&gt;%
  mutate(prob = n_counts / sum(n_counts)) %&gt;%
  ungroup()

# write the pmf data to a csv file
write.csv(pmf_data, file = file.path(&quot;./output/pmf_sibling_counts.csv&quot;), row.names = FALSE)</code></pre>
<pre class="r"><code>plot_pmf(pmf_data)</code></pre>
<p><img src="figure/fert_model.Rmd/plot-pmf-fig-1.png" width="768" style="display: block; margin: auto;" /></p>
<pre class="r"><code>ggsave(file = file.path(&quot;./output/pmf_sibling_counts.png&quot;), width = 8, height = 6, dpi = 500)</code></pre>
<pre class="r"><code>sum(pmf_data$n_counts[pmf_data$Model == &quot;Poisson&quot;])</code></pre>
<pre><code>[1] 50557</code></pre>
<pre class="r"><code>sum(pmf_data$n_counts[pmf_data$Model == &quot;ZINB&quot;])</code></pre>
<pre><code>[1] 49626</code></pre>
<pre class="r"><code>pmf_data$n_counts[pmf_data$Model == &quot;Poisson&quot;] / sum(pmf_data$n_counts[pmf_data$Model == &quot;Poisson&quot;])</code></pre>
<pre><code> [1] 0.0794153134 0.1986668513 0.2630496272 0.2089522717 0.1366774136
 [6] 0.0723935360 0.0260300255 0.0102854204 0.0039163716 0.0003955931
[11] 0.0002175762</code></pre>
<pre class="r"><code>pmf_data$n_counts[pmf_data$Model == &quot;ZINB&quot;] / sum(pmf_data$n_counts[pmf_data$Model == &quot;ZINB&quot;])</code></pre>
<pre><code> [1] 0.079655826 0.159714666 0.189336235 0.175150123 0.137730222 0.103010519
 [7] 0.063051626 0.040462661 0.023939064 0.013299480 0.007758030 0.003385322
[13] 0.003506227</code></pre>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 4.3.1 (2023-06-16)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS 15.5

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Detroit
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] viridisLite_0.4.2 ggplot2_3.5.2     knitr_1.50        pscl_1.5.9       
[5] MASS_7.3-60       readr_2.1.5       tidyr_1.3.1       dplyr_1.1.4      
[9] workflowr_1.7.1  

loaded via a namespace (and not attached):
 [1] utf8_1.2.5         sass_0.4.10        generics_0.1.4     stringi_1.8.7     
 [5] hms_1.1.3          digest_0.6.37      magrittr_2.0.3     evaluate_1.0.3    
 [9] grid_4.3.1         RColorBrewer_1.1-3 fastmap_1.2.0      rprojroot_2.0.4   
[13] jsonlite_2.0.0     processx_3.8.6     whisker_0.4.1      ps_1.9.1          
[17] promises_1.3.3     httr_1.4.7         purrr_1.0.4        scales_1.4.0      
[21] textshaping_1.0.1  jquerylib_0.1.4    cli_3.6.5          crayon_1.5.3      
[25] rlang_1.1.6        bit64_4.6.0-1      withr_3.0.2        cachem_1.1.0      
[29] yaml_2.3.10        parallel_4.3.1     tools_4.3.1        tzdb_0.5.0        
[33] httpuv_1.6.16      vctrs_0.6.5        R6_2.6.1           lifecycle_1.0.4   
[37] git2r_0.36.2       stringr_1.5.1      bit_4.6.0          fs_1.6.6          
[41] vroom_1.6.5        ragg_1.4.0         pkgconfig_2.0.3    callr_3.7.6       
[45] pillar_1.10.2      bslib_0.9.0        later_1.4.2        gtable_0.3.6      
[49] glue_1.8.0         Rcpp_1.0.14        systemfonts_1.2.3  xfun_0.52         
[53] tibble_3.2.1       tidyselect_1.2.1   rstudioapi_0.17.1  farver_2.1.2      
[57] htmltools_0.5.8.1  labeling_0.4.3     rmarkdown_2.29     compiler_4.3.1    
[61] getPass_0.2-4     </code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
https://docs.mathjax.org/en/latest/web/configuration.html. This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>




</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
